<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LLDPQ Dashboard</title>
    <link rel="shortcut icon" href="/png/favicon.ico">
    <link rel="stylesheet" type="text/css" href="/css/styles2.css">
    <style>
        html, body {
            margin: 0;
            padding: 0;
            overflow-x: hidden;
            overflow-y: auto;
        }
        
        .dashboard-container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
            min-height: 100vh;
            box-sizing: border-box;
        }
        
        .analysis-section {
            margin: 30px 0;
            background: #2d2d2d;
            border-radius: 12px;
            padding: 25px;
            border: 1px solid #444;
        }
        
        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 10px;
        }
        
        .section-title {
            font-size: 22px;
            font-weight: bold;
            color: #b57614;
            margin: 0;
            background: rgba(181, 118, 20, 0.1);
            padding: 8px 16px;
            border-radius: 6px;
            border: 1px solid rgba(181, 118, 20, 0.3);
            display: inline-block;
            transition: all 0.3s ease;
            cursor: pointer;
        }
        
        .section-title:hover {
            background: rgba(181, 118, 20, 0.2);
            border-color: rgba(181, 118, 20, 0.5);
            transform: translateY(-1px);
        }
        
        .summary-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }
        
        .summary-card {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            border-left: 5px solid #007bff;
            transition: all 0.3s ease;
            cursor: pointer;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .summary-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 12px rgba(0,0,0,0.15);
        }
        
        .card-value {
            font-size: 28px;
            font-weight: bold;
            color: #333;
            margin-bottom: 8px;
        }
        
        .card-label {
            font-size: 14px;
            color: #666;
            font-weight: 500;
        }
        
        /* Card Border Colors */
        .card-total { border-left-color: #2196f3; }
        .card-excellent { border-left-color: #4caf50; }
        .card-good { border-left-color: #8bc34a; }
        .card-warning { border-left-color: #ff9800; }
        .card-critical { border-left-color: #f44336; }
        .card-info { border-left-color: #17a2b8; }
        
        /* Status Colors */
        .status-excellent { color: #4caf50; }
        .status-good { color: #8bc34a; }
        .status-warning { color: #ff9800; }
        .status-critical { color: #f44336; }
        .status-info { color: #17a2b8; }
        
        .main-title {
            font-size: 3.2em;
            font-weight: bold;
            color: #b57614;
            text-align: center;
            margin: 20px 0;
            text-shadow: 0 0 10px rgba(181, 118, 20, 0.3);
        }
        
        .last-updated {
            text-align: center;
            margin: 20px 0;
            color: #ccc;
            font-size: 16px;
        }
        
        .nvidia-logo {
            text-align: center;
            margin: 10px 0 20px 0;
        }
        
        .nvidia-logo img {
            max-width: 200px;
            border-radius: 10px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        }
        
        .dashboard-stats {
            background: linear-gradient(135deg, #3d3d3d 0%, #4a4a4a 100%);
            border: 1px solid #b57614;
            border-radius: 12px;
            padding: 20px;
            margin: 30px 0;
            text-align: center;
            color: #e0e0e0;
            box-shadow: 0 4px 8px rgba(181, 118, 20, 0.2);
        }
        
        .dashboard-stats h3 {
            margin: 0 0 15px 0;
            font-size: 20px;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }
        
        .stat-item {
            background: rgba(181, 118, 20, 0.1);
            border: 1px solid rgba(181, 118, 20, 0.3);
            padding: 15px;
            border-radius: 8px;
            transition: all 0.3s ease;
        }
        
        .stat-item:hover {
            background: rgba(181, 118, 20, 0.2);
            border-color: rgba(181, 118, 20, 0.5);
        }
        
        .stat-value {
            font-size: 24px;
            font-weight: bold;
            margin-bottom: 5px;
        }
        
        .stat-label {
            font-size: 12px;
            opacity: 0.9;
        }
    </style>
</head>
<body>
    <div class="dashboard-container">
        <h1 class="main-title">LLDPQ</h1>
        
        <div class="nvidia-logo">
            <img src="/png/nvidia-logo.jpg" alt="NVIDIA Logo">
        </div>
        
        <div class="last-updated">
            <strong>Last Updated:</strong> <span id="last-updated-time"></span>
        </div>
        
        <!-- Dashboard Overview Stats -->
        <div class="dashboard-stats">
            <h3>Network Health Overview</h3>
            <div class="stats-grid">
                <div class="stat-item">
                    <div class="stat-value" id="total-network-devices">--</div>
                    <div class="stat-label">Total Network Devices</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value" id="total-interfaces">--</div>
                    <div class="stat-label">Total Interfaces</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value" id="overall-health">--</div>
                    <div class="stat-label">Overall Health</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value" id="critical-issues">--</div>
                    <div class="stat-label">Critical Issues</div>
                </div>
            </div>
        </div>

        <!-- Assets Analysis Section -->
        <div class="analysis-section">
            <div class="section-header">
                <h2 class="section-title" onclick="window.location.href='assets.html'">Asset Analysis</h2>
            </div>
            <div class="summary-grid">
                <div class="summary-card card-total" onclick="window.location.href='assets.html'">
                    <div class="card-value" id="assets-total">16</div>
                    <div class="card-label">Total Devices</div>
                </div>
                <div class="summary-card card-excellent" onclick="window.location.href='assets.html'">
                    <div class="card-value status-excellent" id="assets-success">16</div>
                    <div class="card-label">Successful</div>
                </div>
                <div class="summary-card card-warning" onclick="window.location.href='assets.html'">
                    <div class="card-value status-warning" id="assets-warnings">0</div>
                    <div class="card-label">Warnings</div>
                </div>
                <div class="summary-card card-critical" onclick="window.location.href='assets.html'">
                    <div class="card-value status-critical" id="assets-failed">0</div>
                    <div class="card-label">Failed</div>
                </div>
                <div class="summary-card card-info" onclick="window.location.href='assets.html'">
                    <div class="card-value status-info" id="assets-no-info">0</div>
                    <div class="card-label">No Information</div>
                </div>
            </div>
        </div>

        <!-- LLDP Analysis Section -->
        <div class="analysis-section">
            <div class="section-header">
                <h2 class="section-title" onclick="window.location.href='lldp.html'">LLDP Topology Analysis</h2>
            </div>
            <div class="summary-grid">
                <div class="summary-card card-total" onclick="window.location.href='lldp.html'">
                    <div class="card-value" id="lldp-total">78</div>
                    <div class="card-label">Total Connections</div>
                </div>
                <div class="summary-card card-excellent" onclick="window.location.href='lldp.html'">
                    <div class="card-value status-excellent" id="lldp-success">72</div>
                    <div class="card-label">Successful Links</div>
                </div>
                <div class="summary-card card-critical" onclick="window.location.href='lldp.html'">
                    <div class="card-value status-critical" id="lldp-failed">2</div>
                    <div class="card-label">Failed Links</div>
                </div>
                <div class="summary-card card-warning" onclick="window.location.href='lldp.html'">
                    <div class="card-value status-warning" id="lldp-warning">3</div>
                    <div class="card-label">Warning Links</div>
                </div>
                <div class="summary-card card-info" onclick="window.location.href='lldp.html'">
                    <div class="card-value status-info" id="lldp-no-info">1</div>
                    <div class="card-label">No Info Links</div>
                </div>
            </div>
        </div>

        <!-- BGP Analysis Section -->
        <div class="analysis-section">
            <div class="section-header">
                <h2 class="section-title" onclick="window.location.href='monitor-results/bgp-analysis.html'">BGP Neighbor Analysis</h2>
            </div>
            <div class="summary-grid">
                <div class="summary-card card-total" onclick="window.location.href='monitor-results/bgp-analysis.html'">
                    <div class="card-value" id="bgp-devices">0</div>
                    <div class="card-label">BGP Devices</div>
                </div>
                <div class="summary-card card-info" onclick="window.location.href='monitor-results/bgp-analysis.html'">
                    <div class="card-value" id="bgp-neighbors">0</div>
                    <div class="card-label">Total Neighbors</div>
                </div>
                <div class="summary-card card-excellent" onclick="window.location.href='monitor-results/bgp-analysis.html'">
                    <div class="card-value status-excellent" id="bgp-established">0</div>
                    <div class="card-label">Established</div>
                </div>
                <div class="summary-card card-critical" onclick="window.location.href='monitor-results/bgp-analysis.html'">
                    <div class="card-value status-critical" id="bgp-down">0</div>
                    <div class="card-label">Down/Problem</div>
                </div>
                <div class="summary-card card-total" onclick="window.location.href='monitor-results/bgp-analysis.html'">
                    <div class="card-value" id="bgp-health">0.0%</div>
                    <div class="card-label">Health Ratio</div>
                </div>
            </div>
        </div>

        <!-- Optical Analysis Section -->
        <div class="analysis-section">
            <div class="section-header">
                <h2 class="section-title" onclick="window.location.href='monitor-results/optical-analysis.html'">Optical Diagnostics Analysis</h2>
            </div>
            <div class="summary-grid">
                <div class="summary-card card-total" onclick="window.location.href='monitor-results/optical-analysis.html'">
                    <div class="card-value" id="optical-total">944</div>
                    <div class="card-label">Total Ports</div>
                </div>
                <div class="summary-card card-excellent" onclick="window.location.href='monitor-results/optical-analysis.html'">
                    <div class="card-value status-excellent" id="optical-excellent">725</div>
                    <div class="card-label">Excellent</div>
                </div>
                <div class="summary-card card-good" onclick="window.location.href='monitor-results/optical-analysis.html'">
                    <div class="card-value status-good" id="optical-good">32</div>
                    <div class="card-label">Good</div>
                </div>
                <div class="summary-card card-warning" onclick="window.location.href='monitor-results/optical-analysis.html'">
                    <div class="card-value status-warning" id="optical-warning">0</div>
                    <div class="card-label">Warning</div>
                </div>
                <div class="summary-card card-critical" onclick="window.location.href='monitor-results/optical-analysis.html'">
                    <div class="card-value status-critical" id="optical-critical">187</div>
                    <div class="card-label">Critical</div>
                </div>
            </div>
        </div>

        <!-- BER Analysis Section -->
        <div class="analysis-section">
            <div class="section-header">
                <h2 class="section-title" onclick="window.location.href='monitor-results/ber-analysis.html'">BER Analysis</h2>
            </div>
            <div class="summary-grid">
                <div class="summary-card card-total" onclick="window.location.href='monitor-results/ber-analysis.html'">
                    <div class="card-value" id="ber-total">0</div>
                    <div class="card-label">Total Ports</div>
                </div>
                <div class="summary-card card-excellent" onclick="window.location.href='monitor-results/ber-analysis.html'">
                    <div class="card-value status-excellent" id="ber-excellent">0</div>
                    <div class="card-label">Excellent</div>
                </div>
                <div class="summary-card card-good" onclick="window.location.href='monitor-results/ber-analysis.html'">
                    <div class="card-value status-good" id="ber-good">0</div>
                    <div class="card-label">Good</div>
                </div>
                <div class="summary-card card-warning" onclick="window.location.href='monitor-results/ber-analysis.html'">
                    <div class="card-value status-warning" id="ber-warning">0</div>
                    <div class="card-label">Warning</div>
                </div>
                <div class="summary-card card-critical" onclick="window.location.href='monitor-results/ber-analysis.html'">
                    <div class="card-value status-critical" id="ber-critical">0</div>
                    <div class="card-label">Critical</div>
                </div>
            </div>
        </div>

        <!-- Link Flap Analysis Section -->
        <div class="analysis-section">
            <div class="section-header">
                <h2 class="section-title" onclick="window.location.href='monitor-results/link-flap-analysis.html'">Link Flap Detection</h2>
            </div>
            <div class="summary-grid">
                <div class="summary-card card-total" onclick="window.location.href='monitor-results/link-flap-analysis.html'">
                    <div class="card-value" id="flap-devices">1</div>
                    <div class="card-label">Total Devices</div>
                </div>
                <div class="summary-card card-info" onclick="window.location.href='monitor-results/link-flap-analysis.html'">
                    <div class="card-value" id="flap-ports">4</div>
                    <div class="card-label">Total Ports</div>
                </div>
                <div class="summary-card card-excellent" onclick="window.location.href='monitor-results/link-flap-analysis.html'">
                    <div class="card-value status-excellent" id="flap-stable">4</div>
                    <div class="card-label">Stable</div>
                </div>
                <div class="summary-card card-critical" onclick="window.location.href='monitor-results/link-flap-analysis.html'">
                    <div class="card-value status-critical" id="flap-problematic">0</div>
                    <div class="card-label">Problematic</div>
                </div>
                <div class="summary-card card-total" onclick="window.location.href='monitor-results/link-flap-analysis.html'">
                    <div class="card-value" id="flap-stability">100.0%</div>
                    <div class="card-label">Stability Ratio</div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Set last updated time
        function setLastUpdated() {
            const now = new Date();
            const options = { 
                year: 'numeric', 
                month: '2-digit', 
                day: '2-digit', 
                hour: '2-digit', 
                minute: '2-digit',
                second: '2-digit',
                hour12: true
            };
            const formattedDate = now.toLocaleString('en-US', options);
            document.getElementById('last-updated-time').textContent = formattedDate;
        }

        // Fetch summary data directly from data files
        async function fetchRawDataSummary(dataType) {
            try {
                let summaryData = {};
                
                if (dataType === 'assets') {
                    // Parse assets.ini directly
                    const response = await fetch('assets.ini');
                    const text = await response.text();
                    const lines = text.split('\n').filter(line => line.trim());
                    
                    summaryData.totalDevices = lines.length;
                    summaryData.successful = 0;
                    summaryData.failed = 0;
                    summaryData.warning = 0;
                    summaryData.noInfo = 0;
                    
                    lines.forEach(line => {
                        const parts = line.split('|');
                        if (parts.length >= 7) {
                            const status = parts[6].trim();
                            if (status === 'SUCCESS') summaryData.successful++;
                            else if (status === 'FAILED') summaryData.failed++;
                            else if (status === 'WARNING') summaryData.warning++;
                            else if (status === 'NO INFO') summaryData.noInfo++;
                        }
                    });
                    
                } else if (dataType === 'lldp') {
                    // Parse lldp_results.ini directly
                    const response = await fetch('lldp_results.ini');
                    const text = await response.text();
                    const lines = text.split('\n').filter(line => line.trim());
                    
                    summaryData.totalConnections = lines.length;
                    summaryData.successful = 0;
                    summaryData.failed = 0;
                    summaryData.warning = 0;
                    summaryData.noInfo = 0;
                    
                    lines.forEach(line => {
                        const parts = line.split('|');
                        if (parts.length >= 6) {
                            const status = parts[5].trim();
                            if (status === 'Pass') summaryData.successful++;
                            else if (status === 'Fail') summaryData.failed++;
                            else if (status === 'No-Info') summaryData.noInfo++;
                        }
                    });
                    
                } else {
                    // For analysis pages, fetch the generated HTML and parse its summary cards
                    const pageMap = {
                        'bgp': 'monitor-results/bgp-analysis.html',
                        'optical': 'monitor-results/optical-analysis.html',
                        'ber': 'monitor-results/ber-analysis.html',
                        'flap': 'monitor-results/link-flap-analysis.html'
                    };
                    
                    const pageUrl = pageMap[dataType];
                    if (pageUrl) {
                        const response = await fetch(pageUrl);
                        const html = await response.text();
                        const parser = new DOMParser();
                        const doc = parser.parseFromString(html, 'text/html');
                        const cards = doc.querySelectorAll('.summary-card');
                        
                        cards.forEach(card => {
                            const valueElement = card.querySelector('.card-value');
                            const labelElement = card.querySelector('.card-label');
                            
                            if (valueElement && labelElement) {
                                const value = valueElement.textContent.trim();
                                const label = labelElement.textContent.trim().toLowerCase();
                                
                                if (label.includes('total devices')) summaryData.totalDevices = parseInt(value) || 0;
                                else if (label.includes('total ports')) summaryData.totalPorts = parseInt(value) || 0;
                                else if (label.includes('total neighbors')) summaryData.totalNeighbors = parseInt(value) || 0;
                                else if (label.includes('excellent')) summaryData.excellent = parseInt(value) || 0;
                                else if (label.includes('good')) summaryData.good = parseInt(value) || 0;
                                else if (label.includes('established')) summaryData.established = parseInt(value) || 0;
                                else if (label.includes('stable')) summaryData.stable = parseInt(value) || 0;
                                else if (label.includes('failed') || label.includes('down')) summaryData.failed = parseInt(value) || 0;
                                else if (label.includes('problematic')) summaryData.problematic = parseInt(value) || 0;
                                else if (label.includes('warning')) summaryData.warning = parseInt(value) || 0;
                                else if (label.includes('critical')) summaryData.critical = parseInt(value) || 0;
                                else if (label.includes('health') && value.includes('%')) summaryData.healthPercent = parseFloat(value) || 0;
                                else if (label.includes('stability') && value.includes('%')) summaryData.stabilityPercent = parseFloat(value) || 0;
                            }
                        });
                    }
                }
                
                console.log(`Fetched ${dataType} data:`, summaryData);
                return summaryData;
                
            } catch (error) {
                console.warn(`Failed to fetch ${dataType} data:`, error);
                return {};
            }
        }

        // Calculate overall network stats with real-time data
        async function updateNetworkStats() {
            try {
                console.log('Starting updateNetworkStats...');
                
                // Fetch data directly from raw data files
                console.log('Fetching data from raw data files...');
                const [assetsData, lldpData, bgpData, opticalData, berData, flapData] = await Promise.all([
                    fetchRawDataSummary('assets'),
                    fetchRawDataSummary('lldp'), 
                    fetchRawDataSummary('bgp'),
                    fetchRawDataSummary('optical'),
                    fetchRawDataSummary('ber'),
                    fetchRawDataSummary('flap')
                ]);
                
                console.log('All raw data fetched:', {
                    assets: assetsData,
                    lldp: lldpData,
                    bgp: bgpData,
                    optical: opticalData,
                    ber: berData,
                    flap: flapData
                });

                // Update dashboard summary cards
                updateDashboardCard('assets-total', assetsData.totalDevices);
                updateDashboardCard('assets-success', assetsData.successful);
                updateDashboardCard('assets-warning', assetsData.warning);
                updateDashboardCard('assets-failed', assetsData.failed);
                updateDashboardCard('assets-no-info', assetsData.noInfo);

                updateDashboardCard('lldp-total', lldpData.totalConnections);
                updateDashboardCard('lldp-success', lldpData.successful);
                updateDashboardCard('lldp-failed', lldpData.failed);
                updateDashboardCard('lldp-warning', lldpData.warning);
                updateDashboardCard('lldp-no-info', lldpData.noInfo);

                updateDashboardCard('bgp-devices', bgpData.totalDevices);
                updateDashboardCard('bgp-neighbors', bgpData.totalNeighbors);
                updateDashboardCard('bgp-established', bgpData.established);
                updateDashboardCard('bgp-down', bgpData.failed);
                updateDashboardCard('bgp-health', bgpData.healthPercent ? bgpData.healthPercent + '%' : '0.0%');

                updateDashboardCard('optical-total', opticalData.totalPorts);
                updateDashboardCard('optical-excellent', opticalData.excellent);
                updateDashboardCard('optical-good', opticalData.good);
                updateDashboardCard('optical-warning', opticalData.warning);
                updateDashboardCard('optical-critical', opticalData.critical);

                updateDashboardCard('ber-total', berData.totalPorts);
                updateDashboardCard('ber-excellent', berData.excellent);
                updateDashboardCard('ber-good', berData.good);
                updateDashboardCard('ber-warning', berData.warning);
                updateDashboardCard('ber-critical', berData.critical);

                updateDashboardCard('flap-devices', flapData.totalDevices);
                updateDashboardCard('flap-ports', flapData.totalPorts);
                updateDashboardCard('flap-stable', flapData.stable);
                updateDashboardCard('flap-problematic', flapData.problematic);
                updateDashboardCard('flap-stability', flapData.stabilityPercent ? flapData.stabilityPercent + '%' : '0.0%');

                // Calculate overall network statistics
                const totalDevices = assetsData.totalDevices || 0;
                const totalInterfaces = Math.max(opticalData.totalPorts || 0, berData.totalPorts || 0);
                
                const criticalIssues = 
                    (assetsData.failed || 0) +
                    (lldpData.failed || 0) +
                    (bgpData.failed || 0) +
                    (opticalData.critical || 0) +
                    (berData.critical || 0) +
                    (flapData.problematic || 0);
                
                const healthyItems = 
                    (assetsData.successful || 0) +
                    (lldpData.successful || 0) +
                    (opticalData.excellent || 0) +
                    (flapData.stable || 0);
                
                const totalAssessments = 
                    totalDevices + 
                    (lldpData.totalConnections || 0) + 
                    (opticalData.totalPorts || 0) + 
                    (flapData.totalPorts || 0);
                
                const overallHealth = totalAssessments > 0 ? Math.round((healthyItems / totalAssessments) * 100) : 0;
                
                // Update dashboard stats
                document.getElementById('total-network-devices').textContent = totalDevices;
                document.getElementById('total-interfaces').textContent = totalInterfaces;
                document.getElementById('overall-health').textContent = overallHealth + '%';
                document.getElementById('critical-issues').textContent = criticalIssues;
                
                // Color code the health percentage
                const healthElement = document.getElementById('overall-health');
                if (overallHealth >= 95) {
                    healthElement.style.color = '#4caf50';
                } else if (overallHealth >= 85) {
                    healthElement.style.color = '#8bc34a';
                } else if (overallHealth >= 70) {
                    healthElement.style.color = '#ff9800';
                } else {
                    healthElement.style.color = '#f44336';
                }
                
                // Color code critical issues
                const criticalElement = document.getElementById('critical-issues');
                if (criticalIssues === 0) {
                    criticalElement.style.color = '#4caf50';
                } else if (criticalIssues <= 5) {
                    criticalElement.style.color = '#ff9800';
                } else {
                    criticalElement.style.color = '#f44336';
                }
                
            } catch (error) {
                console.error('Failed to update network stats:', error);
            }
        }

        // Helper function to update dashboard card values
        function updateDashboardCard(elementId, value) {
            const element = document.getElementById(elementId);
            if (element) {
                element.textContent = value !== undefined && value !== null ? value : 0;
            }
        }

        // Initialize dashboard
        document.addEventListener('DOMContentLoaded', function() {
            setLastUpdated();
            updateNetworkStats();
            
            // Update every 30 seconds
            setInterval(function() {
                setLastUpdated();
                updateNetworkStats();
            }, 30000);
        });

        // Add hover effects for clickable cards
        document.querySelectorAll('.summary-card[onclick]').forEach(card => {
            card.style.cursor = 'pointer';
        });
    </script>
</body>
</html>
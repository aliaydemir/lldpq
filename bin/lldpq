#!/bin/bash
# LLDPq Network Monitoring - Main execution script  
# Copyright (c) 2024 LLDPq Project - Licensed under MIT License

cd ~/cable-check/

wait_until_not_running() {
    script_name="$1"
    while pgrep -f "$script_name" >/dev/null; do
        sleep 10
    done
}

# Run asset discovery and LLDP checks
wait_until_not_running "assets.sh"
/bin/bash ./assets.sh >/dev/null 2>&1

wait_until_not_running "check-lldp.sh"
/bin/bash ./check-lldp.sh >/dev/null 2>&1

# Check for network alerts (only if monitoring data exists)
if [[ -d "monitor-results" ]] && [[ -f "notifications.yaml" ]]; then
    echo "üîç $(date '+%Y-%m-%d %H:%M:%S') - Running alert checks..."
    python3 ./check_alerts.py 2>/dev/null || echo "‚ö†Ô∏è  Alert check failed (non-critical)"
fi

exit 0
